import streamlit as st
import pandas as pd

st.set_page_config(page_title="Simulation interactive CSV", layout="wide")
st.title("üìä Simulation interactive CSV")

# Upload CSV
uploaded_file = st.file_uploader("Importer un fichier CSV", type=["csv"])

if uploaded_file:
    df = pd.read_csv(uploaded_file)
    st.subheader("Aper√ßu des donn√©es")
    st.dataframe(df.head())

    # S√©lection des colonnes num√©riques
    numeric_cols = df.select_dtypes(include="number").columns.tolist()
    cols_selected = st.multiselect(
        "S√©lectionner les colonnes √† ajuster",
        numeric_cols,
        default=numeric_cols[:1]  # par d√©faut, la premi√®re colonne
    )

    # Param√®tre modifiable
    facteur = st.number_input("Facteur multiplicatif", value=1.0, step=0.1)

    # Calcul dynamique pour toutes les colonnes s√©lectionn√©es
    for col in cols_selected:
        df[f"{col}_ajust√©e"] = df[col] * facteur

    st.subheader("R√©sultat simul√©")
    st.dataframe(df)

    # Statistiques simples
    st.subheader("Statistiques")
    for col in cols_selected:
        st.metric(f"Moyenne {col}_ajust√©e", round(df[f"{col}_ajust√©e"].mean(), 2))
        st.metric(f"Total {col}_ajust√©e", round(df[f"{col}_ajust√©e"].sum(), 2))

    # Export CSV final
    csv = df.to_csv(index=False).encode("utf-8")
    st.download_button(
        label="üì• T√©l√©charger la version CSV finale",
        data=csv,
        file_name="resultat_simulation.csv",
        mime="text/csv"
    )
